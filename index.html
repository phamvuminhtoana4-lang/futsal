<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FUTSAL SUPER CHAMPION 2026</title>
    <style>
        :root { --pitch: #1b5e20; }
        body { margin: 0; background: #000; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; user-select: none; }
        
        /* Menu chính */
        #menu { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .btn { padding: 18px 45px; margin: 10px; font-size: 20px; border: none; border-radius: 15px; cursor: pointer; width: 320px; font-weight: bold; transition: 0.3s; box-shadow: 0 5px #000; }
        .btn-ai { background: linear-gradient(#0288d1, #01579b); color: white; }
        .btn-pvp { background: linear-gradient(#f57c00, #e65100); color: white; }
        .btn:active { transform: translateY(4px); box-shadow: none; }

        /* Giao diện game */
        #game-box { display: flex; flex-direction: column; height: 100vh; width: 100vw; }
        .stadium { position: relative; flex: 1; background: var(--pitch); overflow: hidden; border: 3px solid #111; }
        canvas { display: block; width: 100%; height: 100%; }
        
        .hud { position: absolute; width: 100%; padding: 15px; z-index: 10; pointer-events: none; display: flex; justify-content: space-between; font-weight: 900; font-size: 1.2rem; text-shadow: 2px 2px #000; }
        
        #goal-banner { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 6rem; color: #ffeb3b; display: none; z-index: 50; font-weight: 900; animation: pulse 0.5s infinite; }
        @keyframes pulse { 0% { scale: 1; } 50% { scale: 1.1; } 100% { scale: 1; } }
    </style>
</head>
<body>

<div id="menu">
    <h1 style="color: #ffeb3b; font-size: 3rem; margin-bottom: 0;">FUTSAL PRO</h1>
    <p style="opacity: 0.8; margin-bottom: 30px;">Vuốt để di chuyển | Nhấn đúp để sút mạnh</p>
    <button class="btn btn-ai" onclick="start(1)">ĐẤU MÁY (DỄ)</button>
    <button class="btn btn-ai" onclick="start(2)">ĐẤU MÁY (TRUNG BÌNH)</button>
    <button class="btn btn-ai" onclick="start(3)">ĐẤU MÁY (KHÓ)</button>
    <button class="btn btn-pvp" onclick="start(0)">CHẾ ĐỘ PvP (2 NGƯỜI)</button>
</div>

<div id="game-box">
    <div id="side-top" class="stadium">
        <div class="hud"><div>KHÁCH: <span class="score-w">0</span></div></div>
        <canvas id="can-top"></canvas>
    </div>
    <div id="side-bot" class="stadium">
        <div class="hud"><div>CHỦ NHÀ: <span class="score-r">0</span></div></div>
        <canvas id="can-bot"></canvas>
    </div>
</div>
<div id="goal-banner">GOAL!!!</div>

<script>
const cvB = document.getElementById('can-bot'), cvT = document.getElementById('can-top');
const ctxB = cvB.getContext('2d'), ctxT = cvT.getContext('2d');
let W, H, isPvP = false, aiLvl = 0, score = {r:0, w:0}, active = false;
let players = [], ball = {x:0, y:0, vx:0, vy:0, r:9, owner:null};
let lastTap = { time: 0, side: '' };

class Player {
    constructor(x, y, team, label) {
        this.x = x; this.y = y; this.team = team;
        this.vx = 0; this.vy = 0; // Vận tốc quán tính
        this.tx = x; this.ty = y; // Vị trí mục tiêu (ngón tay)
        this.r = 20; this.label = label;
        this.accel = 0.45; // Gia tốc (độ nhạy)
        this.friction = 0.88; // Độ trễ (càng nhỏ càng trượt)
        this.color = team === 'red' ? '#d32f2f' : '#ffffff';
    }

    update() {
        // Vật lý di chuyển theo tay có độ trễ
        let dx = this.tx - this.x, dy = this.ty - this.y;
        let dist = Math.hypot(dx, dy);

        if (dist > 5) {
            this.vx += (dx / dist) * this.accel;
            this.vy += (dy / dist) * this.accel;
        }

        this.vx *= this.friction;
        this.vy *= this.friction;
        this.x += this.vx;
        this.y += this.vy;

        // Giới hạn trong biên dọc
        this.x = Math.max(this.r, Math.min(W - this.r, this.x));
        this.y = Math.max(this.r, Math.min(H - this.r, this.y));

        // Chống dính (Collision)
        players.forEach(p => {
            if (p === this) return;
            let d = Math.hypot(p.x - this.x, p.y - this.y);
            if (d < this.r + p.r + 3) {
                let ang = Math.atan2(p.y - this.y, p.x - this.x);
                this.vx -= Math.cos(ang) * 0.6; this.vy -= Math.sin(ang) * 0.6;
            }
        });

        if (ball.owner === this) {
            ball.x = this.x; ball.y = this.y;
            ball.vx = ball.vy = 0;
        }
    }

    draw(ctx) {
        ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI*2);
        ctx.fillStyle = this.color; ctx.fill();
        ctx.strokeStyle = "#fff"; ctx.lineWidth = 3; ctx.stroke();
        ctx.fillStyle = this.team === 'white' ? '#000' : '#fff';
        ctx.font = "bold 12px Arial"; ctx.textAlign = "center";
        ctx.fillText(this.label, this.x, this.y + 5);
    }
}

function start(mode) {
    aiLvl = mode; isPvP = (mode === 0); active = true;
    document.getElementById('menu').style.display = 'none';
    if (!isPvP) document.getElementById('side-top').style.display = 'none';

    W = window.innerWidth; H = isPvP ? window.innerHeight/2 : window.innerHeight;
    cvB.width = cvT.width = W; cvB.height = cvT.height = H;

    players = [
        new Player(W/2, H-100, 'red', 'P1'), // Cầu thủ đỏ
        new Player(W/2, 100, 'white', 'P2')  // Cầu thủ trắng
    ];
    ball.x = W/2; ball.y = H/2;
    requestAnimationFrame(loop);
}

// Xử lý Vuốt & Tap
const handleInput = (e) => {
    if(!active) return;
    const rect = cvB.getBoundingClientRect();
    Array.from(e.touches).forEach(t => {
        let x, y, team, side;
        if (t.clientY > rect.top + (isPvP ? H : 0)) { // Side Bot (Red)
            x = t.clientX; y = t.clientY - (isPvP ? rect.top + H : rect.top);
            team = 'red'; side = 'B';
        } else { // Side Top (White)
            x = W - t.clientX; y = H - (t.clientY - rect.top);
            team = 'white'; side = 'T';
        }

        let p = players.find(p => p.team === team);
        if(p) { p.tx = x; p.ty = y; }

        // Nhấn đúp để sút
        if (e.type === 'touchstart') {
            let now = Date.now();
            if (now - lastTap.time < 300 && lastTap.side === side && ball.owner && ball.owner.team === team) {
                let dx = x - ball.owner.x, dy = y - ball.owner.y;
                let d = Math.hypot(dx, dy);
                ball.vx = (dx/d)*22; ball.vy = (dy/d)*22;
                ball.owner = null;
            }
            lastTap = { time: now, side: side };
        }
    });
};

window.addEventListener('touchstart', handleInput);
window.addEventListener('touchmove', handleInput);

function loop() {
    if(!active) return;
    players.forEach(p => p.update());
    
    if(!ball.owner) {
        ball.x += ball.vx; ball.y += ball.vy;
        ball.vx *= 0.985; ball.vy *= 0.985;
        players.forEach(p => {
            if(Math.hypot(ball.x - p.x, ball.y - p.y) < p.r + ball.r) ball.owner = p;
        });
    }

    // Luật bàn thắng (Giữa gôn)
    if (ball.y < 0 && ball.x > W*0.3 && ball.x < W*0.7) { score.r++; reset(); }
    else if (ball.y < 0) ball.vy *= -1;

    if (ball.y > H && ball.x > W*0.3 && ball.x < W*0.7) { score.w++; reset(); }
    else if (ball.y > H) ball.vy *= -1;

    if (ball.x < 0 || ball.x > W) ball.vx *= -1;

    // AI 3 cấp độ
    if (aiLvl > 0 && !isPvP) {
        let bot = players.find(p => p.team === 'white');
        let speedMult = 0.2 + (aiLvl * 0.2);
        bot.tx = ball.x; bot.ty = Math.min(ball.y, H*0.35);
        if (ball.owner === bot) { 
            ball.vx = (W/2 - bot.x)*0.1; ball.vy = 10 + aiLvl*6; 
            ball.owner = null; 
        }
    }

    render(ctxB);
    if(isPvP) {
        ctxT.save(); ctxT.translate(W, H); ctxT.rotate(Math.PI); render(ctxT); ctxT.restore();
    }
    requestAnimationFrame(loop);
}

function reset() {
    ball.x = W/2; ball.y = H/2; ball.vx = ball.vy = 0; ball.owner = null;
    document.getElementById('goal-banner').style.display = 'block';
    setTimeout(() => document.getElementById('goal-banner').style.display = 'none', 1200);
}

function render(ctx) {
    ctx.clearRect(0,0,W,H);
    // Sân cỏ
    ctx.strokeStyle = "rgba(255,255,255,0.4)"; ctx.lineWidth = 4;
    ctx.strokeRect(10,10,W-20,H-20);
    ctx.beginPath(); ctx.moveTo(0, H/2); ctx.lineTo(W, H/2); ctx.stroke();
    ctx.beginPath(); ctx.arc(W/2, H/2, 60, 0, Math.PI*2); ctx.stroke();
    // Gôn
    ctx.fillStyle = "rgba(255,255,255,0.8)";
    ctx.fillRect(W*0.3, 0, W*0.4, 10);
    ctx.fillRect(W*0.3, H-10, W*0.4, 10);
    
    players.forEach(p => p.draw(ctx));
    // Bóng
    ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
    ctx.fillStyle = "#ffeb3b"; ctx.fill(); ctx.strokeStyle = "#000"; ctx.stroke();
    
    document.querySelectorAll('.score-r').forEach(e => e.innerText = score.r);
    document.querySelectorAll('.score-w').forEach(e => e.innerText = score.w);
}
</script>
</body>
</html>
