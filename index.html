<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>FUTSAL CHIẾN THUẬT 5v5</title>
<style>
body{margin:0;background:#022c22;color:#fff;font-family:Arial}
#ui{padding:8px;text-align:center}
button,select{padding:6px;margin:4px}
#game{display:flex;flex-direction:column;height:90vh}
.half{flex:1;position:relative;border-top:2px solid #fff}
canvas{background:#0a7a3d;width:100%;height:100%}
.info{position:absolute;top:5px;left:5px;font-size:12px}
</style>
</head>

<body>

<div id="ui">
  <button onclick="startAI()">Đấu AI</button>
  <select id="aiLevel">
    <option value="1">AI Bình thường</option>
    <option value="2">AI Khá</option>
    <option value="3">AI Rất tốt</option>
  </select>
  <button onclick="startPvP()">Đấu 2 Người</button>
  <span id="time">90:00</span>
</div>

<div id="game">
  <div class="half">
    <canvas id="c1"></canvas>
    <div class="info">Người chơi 1</div>
  </div>
  <div class="half">
    <canvas id="c2"></canvas>
    <div class="info">Người chơi 2 / AI</div>
  </div>
</div>

<script>
const W=400,H=250;
const c1=document.getElementById("c1");
const c2=document.getElementById("c2");
c1.width=c2.width=W;
c1.height=c2.height=H;
const g1=c1.getContext("2d");
const g2=c2.getContext("2d");

let mode="AI",aiLevel=1;
let time=90*60,interval;

const ball={x:200,y:125,vx:0,vy:0,owner:null};

function team(color,gk){
  return [
    {x:80,y:60,c:color},{x:80,y:125,c:color},
    {x:80,y:190,c:color},{x:140,y:125,c:color},
    {x:30,y:125,c:gk,gk:true}
  ];
}

let A=team("red","blue");
let B=team("white","black");

function draw(ctx){
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle="#fff";
  ctx.strokeRect(10,10,W-20,H-20);
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,5,0,7);
  ctx.fillStyle="yellow";ctx.fill();
  [...A,...B].forEach(p=>{
    ctx.beginPath();
    ctx.arc(p.x,p.y,8,0,7);
    ctx.fillStyle=p.c;ctx.fill();
  });
}

function update(){
  ball.x+=ball.vx;
  ball.y+=ball.vy;
  ball.vx*=0.98;ball.vy*=0.98;

  if(mode==="AI"){
    B.forEach(p=>{
      let dx=ball.x-p.x,dy=ball.y-p.y;
      let d=Math.hypot(dx,dy);
      if(d<80){
        p.x+=dx/d*aiLevel*0.5;
        p.y+=dy/d*aiLevel*0.5;
      }
    });
  }
}

function loop(){
  update();
  draw(g1);draw(g2);
}

function tick(){
  time--;
  document.getElementById("time").innerText=
    Math.floor(time/60)+":"+String(time%60).padStart(2,"0");
  if(time<=0) clearInterval(interval);
}

function startAI(){
  mode="AI";
  aiLevel=document.getElementById("aiLevel").value;
  start();
}
function startPvP(){
  mode="PVP";
  start();
}
function start(){
  time=90*60;
  clearInterval(interval);
  interval=setInterval(tick,1000);
}

setInterval(loop,16);

// KÉO CẦU THỦ
function drag(canvas,team){
  let sel=null;
  canvas.onmousedown=e=>{
    let r=canvas.getBoundingClientRect();
    let x=(e.clientX-r.left)/r.width*W;
    let y=(e.clientY-r.top)/r.height*H;
    team.forEach(p=>{
      if(Math.hypot(p.x-x,p.y-y)<10) sel=p;
    });
  };
  canvas.onmousemove=e=>{
    if(sel){
      let r=canvas.getBoundingClientRect();
      sel.x=(e.clientX-r.left)/r.width*W;
      sel.y=(e.clientY-r.top)/r.height*H;
      ball.x=sel.x;ball.y=sel.y;
    }
  };
  canvas.onmouseup=()=>sel=null;
}

drag(c1,A);
drag(c2,B);

// CLICK CHUYỀN / SÚT
let lastClick=0;
[c1,c2].forEach(cv=>{
  cv.onclick=e=>{
    let r=cv.getBoundingClientRect();
    let x=(e.clientX-r.left)/r.width*W;
    let y=(e.clientY-r.top)/r.height*H;
    let now=Date.now();
    let dx=x-ball.x,dy=y-ball.y;
    let d=Math.hypot(dx,dy);
    if(now-lastClick<300){
      ball.vx=dx/d*6;ball.vy=dy/d*6;
    }else{
      ball.vx=dx/d*3;ball.vy=dy/d*3;
    }
    lastClick=now;
  };
});
</script>
</body>
</html>
