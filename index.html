<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Futsal Strategy Simulator</title>
    <style>
        :root { --field: #1b5e20; --line: #ffffff; }
        body { background: #121212; color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; margin: 0; }
        
        #ui { background: #222; padding: 15px; border-bottom: 3px solid #444; width: 100%; display: flex; justify-content: center; gap: 20px; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .stat-box { text-align: center; background: #333; padding: 5px 15px; border-radius: 8px; border: 1px solid #555; }
        .score { font-size: 28px; font-weight: bold; color: #ffeb3b; }
        
        #court { 
            width: 900px; height: 550px; background: var(--field); 
            border: 5px solid var(--line); position: relative; margin: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }

        /* Khung thành và khu vực sân */
        .goal { position: absolute; width: 10px; height: 120px; background: #fff; top: 215px; box-shadow: 0 0 15px white; }
        .goal.left { left: -10px; border-radius: 5px 0 0 5px; }
        .goal.right { right: -10px; border-radius: 0 5px 5px 0; }
        .penalty-area { position: absolute; border: 2px solid var(--line); height: 280px; width: 120px; top: 135px; }
        .penalty-area.left { left: 0; border-left: none; border-radius: 0 140px 140px 0; }
        .penalty-area.right { right: 0; border-right: none; border-radius: 140px 0 0 140px; }
        .center-circle { position: absolute; left: 375px; top: 200px; width: 150px; height: 150px; border: 2px solid var(--line); border-radius: 50%; }

        /* Quân cờ và Bóng */
        .player { 
            width: 32px; height: 32px; border-radius: 50%; position: absolute; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 10px; font-weight: bold; z-index: 10;
            transition: all 0.9s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px rgba(0,0,0,0.4); border: 3px solid;
        }
        .white { background: #fff; color: #000; border-color: #333; }
        .red { background: #f44336; color: #fff; border-color: #0d47a1; }
        
        #ball { 
            width: 16px; height: 16px; background: radial-gradient(circle, #fff, #ffeb3b); 
            border-radius: 50%; position: absolute; z-index: 20;
            transition: all 0.5s ease-out; box-shadow: 0 0 10px #fff;
            display: flex; align-items: center; justify-content: center; font-size: 10px;
        }

        select, button { padding: 10px; border-radius: 5px; cursor: pointer; border: none; font-weight: bold; }
        button { background: #ff9800; color: white; text-transform: uppercase; }
        button:hover { background: #e68a00; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat-box">
        <div style="font-size: 12px;">TỈ SỐ</div>
        <div class="score">TRẮNG <span id="sA">0</span> - <span id="sB">0</span> ĐỎ</div>
    </div>
    <div class="stat-box">
        <div style="font-size: 12px;">THỜI GIAN</div>
        <div id="clock" style="font-size: 20px; font-weight: bold;">00:00</div>
    </div>
    <div style="display: flex; flex-direction: column; gap: 5px;">
        <select id="tacA">
            <option value="121">Trắng: Kim Cương (1-2-1)</option>
            <option value="22">Trắng: Tứ Trụ (2-2)</option>
        </select>
        <select id="tacB">
            <option value="121">Đỏ: Kim Cương (1-2-1)</option>
            <option value="22">Đỏ: Tứ Trụ (2-2)</option>
        </select>
    </div>
    <button onclick="startMatch()">Bắt đầu trận đấu</button>
</div>

<div id="court">
    <div class="goal left"></div>
    <div class="goal right"></div>
    <div class="penalty-area left"></div>
    <div class="penalty-area right"></div>
    <div class="center-circle"></div>
    <div style="position:absolute; left:50%; height:100%; border-left: 2px solid var(--line);"></div>
    
    <div id="players-box"></div>
    <div id="ball">⚽</div>
</div>

<script>
    let scoreA = 0, scoreB = 0, mins = 0, gameLoop;
    const court = document.getElementById('players-box');
    const ball = document.getElementById('ball');

    const formations = {
        "121": [ {r:'GK', x:50, y:260}, {r:'FIX', x:200, y:260}, {r:'ALA', x:350, y:80}, {r:'ALA', x:350, y:440}, {r:'PIV', x:500, y:260} ],
        "22":  [ {r:'GK', x:50, y:260}, {r:'FIX', x:200, y:120}, {r:'FIX', x:200, y:400}, {r:'ALA', x:450, y:120}, {r:'ALA', x:450, y:400} ]
    };

    function startMatch() {
        if(gameLoop) clearInterval(gameLoop);
        scoreA = 0; scoreB = 0; mins = 0;
        document.getElementById('sA').innerText = 0;
        document.getElementById('sB').innerText = 0;
        gameLoop = setInterval(update, 1000); // 1 giây thực tế = 1 phút trong game để quan sát kỹ
    }

    function update() {
        mins++;
        if(mins > 90) { clearInterval(gameLoop); alert("Hết giờ!"); return; }
        document.getElementById('clock').innerText = (mins < 10 ? '0'+mins : mins) + ":00";

        const tA = document.getElementById('tacA').value;
        const tB = document.getElementById('tacB').value;
        
        // Cập nhật vị trí cầu thủ
        court.innerHTML = '';
        let posA = formations[tA].map(p => ({...p, team:'white', cx: p.x + Math.random()*30, cy: p.y + Math.random()*50-25}));
        let posB = formations[tB].map(p => ({...p, team:'red', cx: 900 - p.x - 32 - Math.random()*30, cy: 550 - p.y - 32 + Math.random()*50-25}));

        [...posA, ...posB].forEach(p => {
            const div = document.createElement('div');
            div.className = `player ${p.team}`;
            div.style.left = p.cx + 'px';
            div.style.top = p.cy + 'px';
            div.innerText = p.r;
            court.appendChild(div);
        });

        // Logic phối hợp bóng và ghi bàn
        const attackingSide = Math.random() > 0.5 ? 'A' : 'B';
        const teamData = attackingSide === 'A' ? posA : posB;
        const targetGoal = attackingSide === 'A' ? 'right' : 'left';
        
        // Chọn 1 cầu thủ đang cầm bóng (không phải thủ môn)
        const playerWithBall = teamData[Math.floor(Math.random() * 4) + 1];
        ball.style.left = (playerWithBall.cx + 8) + 'px';
        ball.style.top = (playerWithBall.cy + 8) + 'px';

        // Điều kiện ghi bàn: Phải ở sân đối phương và xác suất
        setTimeout(() => {
            if(attackingSide === 'A' && playerWithBall.cx > 450 && Math.random() > 0.8) {
                ball.style.left = "890px"; ball.style.top = "265px";
                scoreA++; document.getElementById('sA').innerText = scoreA;
            } else if(attackingSide === 'B' && playerWithBall.cx < 450 && Math.random() > 0.8) {
                ball.style.left = "0px"; ball.style.top = "265px";
                scoreB++; document.getElementById('sB').innerText = scoreB;
            }
        }, 500);
    }
</script>
</body>
</html>
