<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Futsal AI Strategy Board</title>
    <style>
        body { background: #111; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        #header { background: #222; width: 100%; padding: 15px; display: flex; justify-content: space-around; border-bottom: 4px solid #444; }
        #pitch { 
            width: 800px; height: 500px; background: #2e7d32; border: 4px solid white; 
            position: relative; margin-top: 20px; overflow: hidden;
        }
        .line { position: absolute; background: white; }
        .center-line { left: 50%; height: 100%; width: 2px; }
        .goal { position: absolute; width: 15px; height: 100px; background: #555; border: 2px solid white; top: 200px; }
        .goal.left { left: 0; } .goal.right { right: 0; }
        
        /* Quân cờ */
        .p { 
            width: 32px; height: 32px; border-radius: 50%; position: absolute; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 11px; font-weight: bold; transition: all 1.2s cubic-bezier(0.25, 0.1, 0.25, 1);
            border: 3px solid; z-index: 10;
        }
        .white-team { background: white; color: black; border-color: black; box-shadow: 0 0 10px white; }
        .red-team { background: #ff1744; color: white; border-color: #002171; box-shadow: 0 0 10px #ff1744; }
        
        #ball { 
            width: 16px; height: 16px; background: #ffeb3b; border-radius: 50%; 
            position: absolute; z-index: 100; transition: all 0.5s ease-out;
            box-shadow: 0 0 15px yellow; display: flex; align-items: center; justify-content: center;
        }
        .score { font-size: 30px; font-weight: bold; color: #ffeb3b; }
        button { padding: 10px 20px; cursor: pointer; background: #2ecc71; border: none; color: white; font-weight: bold; border-radius: 5px; }
    </style>
</head>
<body>

<div id="header">
    <div class="score">TRẮNG <span id="s1">0</span> - <span id="s2">0</span> ĐỎ</div>
    <div>THỜI GIAN: <span id="clock" style="font-size: 20px;">00:00</span></div>
    <div>
        <select id="tacA"><option value="121">Trắng: 1-2-1</option><option value="22">Trắng: 2-2</option></select>
        <select id="tacB"><option value="121">Đỏ: 1-2-1</option><option value="22">Đỏ: 2-2</option></select>
    </div>
    <button onclick="startMatch()">BẮT ĐẦU TRẬN ĐẤU</button>
</div>

<div id="pitch">
    <div class="line center-line"></div>
    <div class="goal left"></div><div class="goal right"></div>
    <div id="players-layer"></div>
    <div id="ball">⚽</div>
</div>

<script>
    let score1 = 0, score2 = 0, mins = 0, timer;
    const layer = document.getElementById('players-layer');
    const ball = document.getElementById('ball');

    // Tọa độ chuẩn (không bao giờ nhầm phe)
    const baseTactics = {
        "121": [ {r:'GK', x:40, y:235}, {r:'FIX', x:150, y:235}, {r:'ALA', x:280, y:80}, {r:'ALA', x:280, y:390}, {r:'PIV', x:450, y:235} ],
        "22":  [ {r:'GK', x:40, y:235}, {r:'FIX', x:150, y:120}, {r:'FIX', x:150, y:350}, {r:'ALA', x:380, y:120}, {r:'ALA', x:380, y:350} ]
    };

    function startMatch() {
        if(timer) clearInterval(timer);
        score1 = 0; score2 = 0; mins = 0;
        document.getElementById('s1').innerText = 0;
        document.getElementById('s2').innerText = 0;
        timer = setInterval(simulateStep, 1500); // Chậm lại để học chiến thuật
    }

    function simulateStep() {
        mins++;
        if(mins > 90) { clearInterval(timer); return; }
        document.getElementById('clock').innerText = (mins < 10 ? '0'+mins : mins) + ":00";

        const tA = document.getElementById('tacA').value;
        const tB = document.getElementById('tacB').value;

        // Xác định đội nào đang cầm bóng tấn công
        const isWhiteAttacking = Math.random() > 0.5;
        
        layer.innerHTML = '';
        
        // ĐỘI TRẮNG (Luôn đi từ Trái sang Phải)
        let whitePlayers = baseTactics[tA].map((p, i) => {
            let nx = p.x + (isWhiteAttacking ? 200 : 0) + (Math.random()*40-20);
            let ny = p.y + (Math.random()*40-20);
            if(i === 0) { nx = 40; ny = 235; } // Thủ môn đứng im
            createPlayer(nx, ny, p.r, 'white-team');
            return {x: nx, y: ny};
        });

        // ĐỘI ĐỎ (Luôn đi từ Phải sang Trái)
        let redPlayers = baseTactics[tB].map((p, i) => {
            let nx = 800 - p.x - 32 - (!isWhiteAttacking ? 200 : 0) + (Math.random()*40-20);
            let ny = 500 - p.y - 32 + (Math.random()*40-20);
            if(i === 0) { nx = 730; ny = 235; } // Thủ môn đứng im
            createPlayer(nx, ny, p.r, 'red-team');
            return {x: nx, y: ny};
        });

        // DI CHUYỂN BÓNG ⚽
        if(isWhiteAttacking) {
            // Chuyền bóng cho 1 cầu thủ đội trắng ở phía trên
            let p = whitePlayers[Math.floor(Math.random()*4)+1];
            ball.style.left = (p.x + 8) + 'px';
            ball.style.top = (p.y + 8) + 'px';
            
            // Nếu PIVOT (quân số 5) ở gần khung thành thì ghi bàn
            if(p.x > 600 && Math.random() > 0.8) {
                setTimeout(() => {
                    ball.style.left = "785px"; ball.style.top = "242px";
                    score1++; document.getElementById('s1').innerText = score1;
                }, 500);
            }
        } else {
            // Đội đỏ tấn công
            let p = redPlayers[Math.floor(Math.random()*4)+1];
            ball.style.left = (p.x + 8) + 'px';
            ball.style.top = (p.y + 8) + 'px';

            if(p.x < 200 && Math.random() > 0.8) {
                setTimeout(() => {
                    ball.style.left = "0px"; ball.style.top = "242px";
                    score2++; document.getElementById('s2').innerText = score2;
                }, 500);
            }
        }
    }

    function createPlayer(x, y, role, team) {
        const div = document.createElement('div');
        div.className = `p ${team}`;
        div.style.left = x + 'px';
        div.style.top = y + 'px';
        div.innerText = role;
        layer.appendChild(div);
    }
</script>
</body>
</html>
